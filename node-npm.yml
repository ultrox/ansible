- name: Setup Node & npm
- hosts: localhost
  vars:
    install_this_node: 14
    npm_global_packages:
      - get-graphql-schema
      - nodemon
      - eslint
      - prettier
      - http-server
  tasks:
    - name: npm prefix
      shell: mkdir -p ~/.local/.npm-global
      tags:
        - install
        - node
    - name: add npmjs to path
      shell: 'PATH=~/.local/.npm-global/bin:$PATH'
      tags:
        - install
        - node
    - name: npm global settings
      shell: npm config set prefix '~/.local/.npm-global'
      tags:
        - install
        - node
    - name: >-
        npmjs global settings export path in case I don't have dotfiles
        installed
      shell: 'export PATH=~/.local/.npm-global/bin:$PATH'
      tags:
        - install
        - node
        - npm-path
    - name: Install N
      npm:
        name: 'n'
        global: 'yes'
      tags:
        - install
        - node
    - name: Install correct version of Node
      shell: n {{install_this_node}}
      tags:
        - install
        - node
    - name: Install common npm utilities
      npm: 'name={{item}} state=present global=yes'
      with_items: '{{npm_global_packages}}'
